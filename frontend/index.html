<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Guideline Assistant - RAG-powered guideline lookup for quality auditors">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>Guideline Assistant</title>
    <!-- Google Fonts: Roboto & Roboto Mono -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&family=Roboto+Mono:wght@400;500;700&display=swap" rel="stylesheet">
    <!-- Material Symbols -->
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/styles.css?v=2.0">
</head>
<body>
    <!-- Main Application Container -->
    <div class="app-container">
        
        <!-- Left Sidebar -->
        <aside class="sidebar" role="complementary" aria-label="Navigation and session management">
            <div class="sidebar-header">
                <h1 class="app-title">Guideline Assistant</h1>
                <button
                    id="new-chat-btn"
                    class="new-chat-button"
                    aria-label="Start a new chat session">
                    <span class="material-symbols-outlined">add</span>
                    <span class="button-text">New Chat</span>
                </button>
            </div>

            <!-- Search and Filter -->
            <div class="sidebar-search">
                <div class="search-input-container">
                    <span class="material-symbols-outlined search-icon">search</span>
                    <input
                        type="text"
                        id="conversation-search-input"
                        class="search-input"
                        placeholder="Search conversations..."
                        autocomplete="off"
                        aria-label="Search conversations"
                    />
                    <button
                        id="clear-search-button"
                        class="clear-search-button"
                        aria-label="Clear search"
                        style="display: none;"
                    >
                        <span class="material-symbols-outlined">close</span>
                    </button>
                </div>

                <div class="search-filters" id="search-filters">
                    <button class="filter-chip" data-filter="today">
                        <span class="material-symbols-outlined">today</span>
                        Today
                    </button>
                    <button class="filter-chip" data-filter="week">
                        <span class="material-symbols-outlined">date_range</span>
                        This Week
                    </button>
                    <button class="filter-chip" data-filter="month">
                        <span class="material-symbols-outlined">calendar_month</span>
                        This Month
                    </button>
                    <button class="filter-chip" data-filter="feedback">
                        <span class="material-symbols-outlined">thumb_up</span>
                        Helpful
                    </button>
                    <button class="filter-chip" data-filter="images">
                        <span class="material-symbols-outlined">image</span>
                        Has Images
                    </button>
                </div>

                <div class="search-results-info" id="search-results-info" style="display: none;">
                    <span id="search-results-count">0 results</span>
                    <button id="clear-all-filters" class="text-button">Clear all</button>
                </div>
            </div>

            <!-- Conversation History -->
            <nav class="conversation-history" aria-label="Conversation history">
                <h2 class="history-title">Recent Conversations</h2>
                <ul id="conversation-list" class="conversation-list" role="list">
                    <!-- Conversation history items will be dynamically inserted here -->
                </ul>
            </nav>

            <!-- Source Links Section -->
            <section class="source-links-section" aria-label="Related documents and websites">
                <h2 class="source-links-title">Links to Document and Website for this Response</h2>
                <div id="source-links-container" class="source-links-container">
                    <p class="no-sources-message">No sources available yet. Submit a query to see related documents.</p>
                </div>
            </section>

            <!-- Admin Portal Link -->
            <div class="sidebar-footer">
                <a href="admin.html" class="admin-link">
                    <span class="material-symbols-outlined">admin_panel_settings</span>
                    Admin Portal
                </a>
            </div>
        </aside>

        <!-- Main Content Area -->
        <main class="main-content" role="main">
            <!-- Conversation Display -->
            <div 
                id="conversation-display" 
                class="conversation-display"
                role="log"
                aria-live="polite"
                aria-label="Conversation messages">
                <!-- Welcome message is rendered by conversation.js showWelcomeMessage() -->
            </div>

            <!-- Query Input Section -->
            <div class="query-input-section">
                <form id="query-form" class="query-form" role="search">
                    <!-- Image Upload Button and Preview -->
                    <div class="image-upload-section">
                        <input
                            type="file"
                            id="image-upload-input"
                            accept="image/jpeg,image/png,image/webp,image/gif"
                            multiple
                            style="display: none;"
                            aria-label="Upload image files">
                        <button
                            type="button"
                            id="upload-image-btn"
                            class="upload-image-button"
                            aria-label="Upload images">
                            <span class="material-symbols-outlined">add_photo_alternate</span>
                        </button>
                        <div id="image-preview-container" class="image-preview-container hidden" role="region" aria-label="Image previews">
                            <!-- Image previews will be inserted here dynamically -->
                        </div>
                    </div>

                    <div class="input-wrapper">
                        <label for="query-input" class="visually-hidden">Enter your question about guidelines</label>
                        <textarea
                            id="query-input"
                            class="query-input"
                            placeholder="Ask a question about guidelines..."
                            rows="1"
                            maxlength="1000"
                            aria-label="Query input field"
                            aria-describedby="query-hint"></textarea>

                        <button
                            type="submit"
                            id="submit-btn"
                            class="submit-button"
                            aria-label="Submit query">
                            <span class="material-symbols-outlined">send</span>
                        </button>
                    </div>
                    <div id="query-hint" class="query-hint">
                        Press Enter to submit, Escape to clear. Drag & drop images or click the camera icon to upload.
                    </div>
                </form>

                <!-- Loading Indicator -->
                <div id="loading-indicator" class="loading-indicator hidden" role="status" aria-live="polite">
                    <div class="loading-spinner"></div>
                    <span class="loading-text">Processing your query...</span>
                </div>
            </div>
        </main>

        <!-- PDF Viewer Panel -->
        <div id="pdf-viewer-container" role="complementary" aria-label="Document viewer">
            <!-- PDF viewer content will be rendered by pdf-viewer.js -->
        </div>
    </div>

    <!-- Scripts -->
    <!-- Fuse.js for fuzzy search -->
    <script src="https://cdn.jsdelivr.net/npm/fuse.js@7.0.0/dist/fuse.min.js"></script>
    <script src="js/confirmation-dialog.js?v=1.0"></script>
    <script src="js/api-client.js?v=2.1"></script>
    <script src="js/query-input.js?v=2.0"></script>
    <script src="js/conversation.js?v=2.0"></script>
    <script src="js/session.js?v=2.0"></script>
    <script src="js/text-fragment-utils.js?v=1.1"></script>
    <script src="js/response-renderer.js?v=2.0"></script>
    <script src="js/response-actions.js?v=2.0"></script>
    <script src="js/feedback.js?v=2.0"></script>
    <script src="js/sidebar.js?v=2.0"></script>
    <script src="js/loading.js?v=2.0"></script>
    <script src="js/pdf-viewer.js?v=2.0"></script>
    <script src="js/conversation-search.js?v=1.0"></script>
    <!-- Autocomplete components -->
    <script src="js/autocomplete-trie.js?v=1.0"></script>
    <script src="js/ghost-text.js?v=1.0"></script>
    <script src="js/suggestion-chips.js?v=1.0"></script>
    <script src="js/app.js?v=2.0"></script>
</body>
</html>
